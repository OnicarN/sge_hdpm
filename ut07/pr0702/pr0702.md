# UT07: Web Controllers y cliente Web


## CONTROLLER

```py
# -*- coding: utf-8 -*-
from odoo import http
from odoo.http import request
import json

class SubscriptionController(http.Controller):

    @http.route('/api/subscription', auth='public', type='http', methods=['GET'], csrf=False)
    def list_subscriptions(self, status=None, page=1, **kwargs):
        
        valid_statuses = ['active', 'expired', 'pending', 'cancelled']
        
       
        if status and status not in valid_statuses:
            error_data = {
                'error': '400 Bad Request',
                'message': f'Estado no válido. Use uno de: {", ".join(valid_statuses)}'
            }
            return request.make_response(
                json.dumps(error_data),
                headers={'Content-Type': 'application/json'},
                status=400
            )

      
        limit = 10 
        try:
            page = int(page)
        except ValueError:
            page = 1
        offset = (page - 1) * limit

        domain = []
        if status:
            domain.append(('status', '=', status))

     
        subscriptions = request.env['subscription.management'].sudo().search(
            domain, limit=limit, offset=offset
        )

        results = []
        for sub in subscriptions:
            results.append({
                'id': sub.id,
                'name': sub.name,
                'customer': sub.customer_id.name,
                'status': sub.status,
                'code': sub.subscription_code
            })

        return request.make_response(
            json.dumps(results),
            headers={'Content-Type': 'application/json'}
        )

    @http.route('/api/subscription/<string:name>', auth='public', type='http', methods=['GET'], csrf=False)
    def get_subscription_detail(self, name, **kwargs):
       
        sub = request.env['subscription.management'].sudo().search([('name', '=', name)], limit=1)

        if not sub:
            return request.make_response(
                json.dumps({'error': '404 Not Found', 'message': f'Suscripción "{name}" no encontrada'}),
                headers={'Content-Type': 'application/json'},
                status=404
            )

        
        data = {
            'name': sub.name,
            'customer': sub.customer_id.name,
            'code': sub.subscription_code,
            'start_date': str(sub.start_date),
            'end_date': str(sub.end_date) if sub.end_date else None,
            'duration_months': sub.duration_months,
            'status': sub.status,
            'price': sub.price,
            'usage_limit': sub.usage_limit,
            'current_usage': sub.current_usage,
            'use_percent': sub.use_percent
        }

        return request.make_response(
            json.dumps(data),
            headers={'Content-Type': 'application/json'}
        )
```        

## ejemplo de uso

![alt text](<Captura de pantalla 2026-02-15 222713.png>)